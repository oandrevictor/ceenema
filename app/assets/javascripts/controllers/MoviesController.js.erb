var controllers = angular.module('ceenema');
/*This Controller
#Creates the search function
#Sends the request to the Database
#Retrieves the result and send to the scope
*/
movies = []
controllers.controller("MoviesController", [ '$scope', '$routeParams', '$location', '$resource', '$http','$window',
    function($scope,$routeParams,$location, $resource, $http,$window) {
        Movie = $resource('/movies/:movieId', {movieId: "@id", format: 'json'});
        $scope.spinner.active = true;

        Movie.query(
            (function (results) {
                $scope.movies = results
                $scope.spinner.active = false;
                $scope.$emit('finishedLoading');
            }))

        //opens the movie page
        $scope.view = function (movieId) {
            $location.path("/movies/" + movieId)
        }

        // Swiper Configuration:

        angular.element(function() {
            //initialize swiper when document ready
            $scope.mySwiper = new Swiper('.swiper-container', {
                direction: 'horizontal',
                mousewheelControl: true,
                paginationClickable: true,
                keyboardControl: true,
                // If we need pagination
                pagination: '.swiper-pagination',
                // Navigation arrows
                nextButton: '.swiper-button-next',
                prevButton: '.swiper-button-prev',
            })
        });

        $scope.onReadySwiper = function (swiper) {
            swiper.initObservers();
            swiper.updateSlidesSize()
        };

        $scope.$on('finishedLoading',function(){
            if ($scope.mySwiper.update){
                $scope.mySwiper.update();
            } })


    }])